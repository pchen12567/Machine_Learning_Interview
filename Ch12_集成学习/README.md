# 第十二章 集成学习
Ensemble Learning <br>
面对一个机器学习问题，通常有两种策略。
- 一种是研发人员尝试各种模型，选择其中表现最好的模型做重点调参优化。
这种策略类似于奥运会比赛，通过强强竞争来选拔最优的运动员，并逐步提高成绩。
- 另一种重要的策略是集各家之长，如同贤明的君主广泛地听取众多谋臣的建议，然后综合考虑，得到最终决策。
后一种策略的核心，是将多个分类器的结果统一成一个最终的决策。使用这类策略的机器学习方法统称为集成学习。其中的每个单独的分类
器称为基分类器。

## 01 集成学习的种类
集成学习是一大类模型融合策略和方法的统称，其中包含多种集成学习的思想。

### 集成学习分哪几种？他们有何异同？
- Boosting
    - Boosting方法训练基分类器时采用串行的方式，各个基分类器之间有依赖。
    - 它的基本思路是将基分类器层层叠加，每一层在训练的时候，对前一层基分类器分错的样本，给予更高的权重。
    测试时，根据各层分类器的结果的加权得到最终结果。
    - Boosting的过程很类似于人类学习的过程，我们学习新知识的过程往往是迭代式的，第一遍学习的时候，
    我们会记住一部分知识，但往往也会犯一些错误，对于这些错误，我们的印象会很深。
    第二遍学习的时候，就会针对犯过错误的知识加强学习，以减少类似的错误发生。不断循环往复，直到犯错误的次数减少到很低的程度。

- Bagging
    - Bagging方法在训练过程中，各基分类器之间无强依赖，可以进行并行训练。
    - 其中很著名的算法之一是基于决策树基分类器的随机森林（Random Forest）。
    为了让基分类器之间互相独立，将训练集分为若干子集（当训练样本数量较少时，子集之间可能有交叠）。
    - Bagging方法更像是一个集体决策的过程，每个个体都进行单独学习，学习的内容可以相同，也可以不同，也可以部分重叠。
    但由于个体之间存在差异性，最终做出的判断不会完全一致。在最终做决策时，每个个体单独作出判断，
    再通过投票的方式做出最后的集体决策。
    
- 基分类器  
    - 有时又被称为弱分类器，因为基分类器的错误率要大于集成分类器。
    - 基分类器的错误，是偏差和方差两种错误之和。偏差主要是由于分类器的表达能力有限导致的系统性错误，
    表现在训练误差不收敛。方差是由于分类器对于样本分布过于敏感，导致在训练样本数较少时，产生过拟合。
    
- Boosting 和 Bagging 的区别
    - Boosting方法是通过逐步聚焦于基分类器分错的样本，减小集成分类器的偏差。
    - Bagging方法则是采取分而治之的策略，通过对训练样本多次采样，并分别训练出多个不同模型，然后做综合，
    来减小集成分类器的方差。
    - 假设所有基分类器出错的概率是独立的，在某个测试样本上，用简单多数投票方法来集成结果，
    超过半数基分类器出错的概率会随着基分类器的数量增加而下降。

如图所示Bagging算法，Model 1、Model 2、Model 3都是用训练集的一个子集训练出来的，单独来看，它们的决策边界都很曲折，
有过拟合的倾向。集成之后的模型（红线所示）的决策边界就比各个独立的模型平滑了，这是由于集成的加权投票方法，减小了方差。
![](https://github.com/pchen12567/picture_store/blob/master/Interview/ensemble_01.png?raw=true)

## 02 集成学习的步骤和例子
虽然集成学习的具体算法和策略各不相同，但都共享同样的基本步骤。

### 集成学习有哪些基本步骤？请举几个集成学习的例子。
- 集成学习一般可以分为以下3个步骤：
    1. 找到误差互相独立的基分类器
    2. 训练基分类器
    3. 合并基分类器的结果

- 合并基分类器的方法：
    1. Voting: 用投票的方式，将获得最多选票的结果作为最终的结果。
    2. Stacking: 用串行的方式，把前一个基分类器的结果输出到下一个分类器，将所有基分类器的输出结果相加
    （或者用更复杂的算法融合，比如把各基分类器的输出作为特征，使用逻辑回归作为融合模型进行最后的结果预测）作为最终的输出。

- Adaboost的基分类器的训练和合并的基本步骤如下：
    1. 确定基分类器：这里可以选取ID3决策树作为基分类器。
    事实上，任何分类模型都可以作为基分类器，但树形模型由于结构简单且较易产生随机性所以比较常用。
    2. 训练基分类器：假设训练集为$\lbrace x_i, y_i \rbrace, i=1,...,M$，其中$y_i \in \lbrace -1, 1 \rbrace$，
    并且有$T$个基分类器，则可以按照如下过程来训练基分类器：
        - 初始化采样分布 $ D_1(i) = \frac {1}{M} $；
        - 令$ t = 1,2,...,T $循环：
            - 从训练集中，按照$D_t$分布，采样出子集$S_t = \lbrace x_i, y_i \rbrace, i=1,...,M_t $；
            - 用$S_t$训练出基分类器 $h_t$；
            - 计算$h_t$的错误率：
            $ \epsilon_t = \frac{\sum_{i=1}^{M_t} \: I[h_t(x_i) \neq y_i]D_t(x_i)}{M_t}$
            其中$I[]$为判别函数；
            - 计算基分类器$h_t$权重 $\alpha_t = \log \frac{1 - \epsilon_t}{\epsilon_t}$；
            - 设置下一次采样
            $$ D_{t+1} = \begin{cases} D_t(i)或者\frac{D_t(i)(1 - \epsilon_t)}{\epsilon_t}, & h_t(x_i) \neq y_i; \\ \frac{D_t(i) \epsilon_t}{(1 - \epsilon_t)}, & h_t(x_i) = y_i \end{cases} $$
            并将它归一化为一个概率分布函数。
    3. 合并基分类器：给定一个位置样本$z$，输出分类结果为加权投票的结果$Sign(\sum_{t=1}^T \: h_t(z) \alpha_t)$。
    
    从Adaboost的例子中可以明显地看到Boosting的思想，对分类正确的样本降低了权重，对分类错误的样本升高或者保持权重不变。
    在最后进行模型融合的过程中，也根据错误率对基分类器进行加权融合。错误率低的分类器拥有更大的“话语权”。
    
- 梯度提升决策树 GBDT
    - 核心思想：每一棵树学的是之前所有树结论和的残差，这个残差就是一个加预测值后能得真实值的累加量。
    - 这里使用残差继续学习，就是GBDT中Gradient Boosted所表达的意思。